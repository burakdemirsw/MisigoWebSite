<main id="main" class="main">
    <!-- <div class="pagetitle"><h1>Sayım Paneli</h1><nav><ol class="breadcrumb"><li class="breadcrumb-item"><a routerLink="/">Home</a></li><li class="breadcrumb-item">Tables</li><li class="breadcrumb-item active">Sayım Paneli</li></ol></nav></div> -->
    <section class="section">
      <div class="row">
        <div style="width: 100%">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Sayım Paneli</h5>
              <div class="form-group row">
                <div class="col-6">
                  <label for="isShelfBased" class="col-form-label">Raf Bazında Sayım</label>
                </div>
                <div class="col-6">
                  <div class="form-check">
                    <input type="checkbox" id="isShelfBased" class="form-check-input" style="margin-top: 10px" formControlName="isShelfBased" />
                  </div>
                </div>
              </div>
              <ul class="nav nav-tabs nav-justified mb-1" id="ex1" role="tablist">
                <!-- <li class="nav-item" role="presentation"><a class="nav-link active" [class.active]="activeTab === 1" (click)="activeTab = 1">Raf
                                          Düzenleme</a></li> -->
              </ul>
              <div class="tab-content" id="ex2-content">
                <div class="tab-pane fade show" [class.active]="activeTab === 1" id="ex3-tabs-1" role="tabpanel" aria-labelledby="ex3-tab-1">
                  <form [formGroup]="checkForm" (ngSubmit)="onSubmit(checkForm.value)">
                    <div class="row mb-1">
                      <div class="form-group col">
                        <label for="office">Hangi Ofis</label>
                        <select id="office" class="form-control" formControlName="office" (change)="getSelectedOffice(1)">
                          <option>M</option>
                          <option>U</option>
                        </select>
                      </div>
                      <div class="form-group col">
                        <label for="warehouseCode">Hangi Depo</label>
                        <select id="warehouseCode" class="form-control" formControlName="warehouseCode">
                          <option *ngFor="let warehouse of warehouseModels" [value]="warehouse.warehouseCode">
                            {{ warehouse.warehouseDescription }}
                          </option>
                        </select>
                      </div>
                    </div>
                    <div class="row mb-1">
                      <div class="form-group">
                        <label for="shelfNo">Raf No:</label>
                        <div class="input-group">
                          <input type="text" id="shelfNo" class="form-control" formControlName="shelfNo" (keydown.enter)="focusNextInput('barcode')" />
                          <div class="input-group-append">
                            <button type="button" (click)="clearShelfNumbers()" class="btn btn-dark"> Formu Temizle </button>
                          </div>
                        </div>
                      </div>
                      <label *ngIf="shelfNumbers !== 'RAFLAR:'" for="shelfNo">{{ shelfNumbers
                                              }}</label>
                    </div>
                    <div class="row mb-1">
                      <div class="form-group">
                        <label for="barcode">Barkod</label>
                        <input type="text" id="barcode" class="form-control" formControlName="barcode" [disabled]="checkForm.disabled" [(ngModel)]="currentbarcode" (ngModelChange)="startBarcodeTimer(currentbarcode)" (keydown.enter)="onSubmit(checkForm.value)" />
                      </div>
                    </div>
                    <div class="row mb-1">
                      <div class="form-group col">
                        <div class="form-group">
                          <label for="quantity">Miktar</label>
                          <input type="number" id="quantity" class="form-control" formControlName="quantity" [disabled]="checkForm.disabled" />
                        </div>
                      </div>
                      <div class="form-group col">
                        <div class="form-group">
                          <label for="batchCode">Parti</label>
                          <input type="text" id="batchCode" class="form-control" formControlName="batchCode" (keydown.enter)="onSubmit(checkForm.value)" [disabled]="checkForm.disabled" />
                        </div>
                      </div>
                    </div>
                    <div class="row mb-1">
                      <div class="form-group col">
                        <button type="button" class="btn btn-primary" (click)="check()" style="width: 100%;"> Ekle </button>
                      </div>
                      <div class="form-group col">
                        <button type="button" class="btn btn-dark" style="margin-left: 10px; color: white" (click)="completeCountFromService(currentOrderNo)" style="width: 100%;"> Sayımı Bitir </button>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="tab-pane fade show" [class.active]="activeTab === 2" id="ex3-tabs-2" role="tabpanel-2" aria-labelledby="ex3-tab-2"></div>
                <div class="tab-pane fade show" [class.active]="activeTab === 3" id="ex3-tabs-3" role="tabpanel-3" aria-labelledby="ex3-tab-3"> Prices </div>
              </div>
            </div>
          </div>
          <div class="card" *ngIf="lastCollectedProducts.length > 0">
            <div class="card-body">
              <h5 class="card-title">Sayılan Ürünler</h5>
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Id</th>
                      <th scope="col">Resim</th>
                      <th scope="col">Raf Numarası</th>
                      <th scope="col">Ürün Kodu</th>
                      <th scope="col">Barkod</th>
                      <th scope="col">Parti</th>
                      <th scope="col">Miktar</th>
                      <th scope="col">İşlem</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let product of lastCollectedProducts | paginate: { itemsPerPage: 10, currentPage: currentPage }  ; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>
                        <img src="{{product.photoUrl}}" alt="Resim" width="50" height="50" (click)="openImageModal(product.photoUrl)">
                      </td>
                      <td>{{ product.shelfNo }}</td>
                      <td>{{ product.itemCode }}</td>
                      <td>{{ product.barcode }}</td>
                      <td>{{ product.batchCode }}</td>
                      <td>{{ product.quantity }}</td>
                      <td>
                        <button class="btn btn-danger" type="submit" (click)="deleteOrderProduct(orderNo,product.barcode,product.shelfNo)">Sil </button>
                        
             <!-- Yeni -->
                        <button class="btn btn-primary" style="margin-left: 1rem;" type="submit" (click)="createJson(product.barcode,product.shelfNo,product.batchCode)">Qr Yazdır </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <pagination-controls (pageChange)="currentPage = $event"></pagination-controls>
              </div>
            </div>
          </div>
          <!-- Yeni kart: Toplanan Ürünler -->
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">Toplanan Ürünler</h5>
              <h1 class="display-1">{{ totalCount}}</h1>
              <p class="card-text">Adet Ürün Toplandı</p>
            </div>
          </div>
        </div>
      </div>

             <!-- Yeni -->
      <qrcode style="display:none ;" (qrCodeURL)="onChangeURL($event)" [qrdata]="qrCodeValue" [width]="256" 
      [errorCorrectionLevel]="'M'"></qrcode> 




       <app-image-modal [imageUrl]="modalImageUrl" [title]="'Ürün Detay'"></app-image-modal>
    </section>
  </main>